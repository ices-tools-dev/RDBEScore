---
title: "Raw Data Import"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Raw Data Import}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Introduction

The aim of this document is to outline the basic workflow of importing data downloaded from the [ICES Regional Database & Estimation System (RDBES)](https://sboxrdbes.ices.dk/#/) or a `list` object containing data frames (or data.tables) into `R` using the `RDBEScore` package.

## Load the package

```{r setup}
library(RDBEScore)
```

## Importing zipped files

It can directly import the `.zip` archive from the RDBES download containing all mandatory Hierarchy tables plus VD and SL:

```{r}
importedH1 <- RDBEScore:::createRDBESDataObject(input = "H1_2023_10_16.zip")
#print the not NULL table names
names(importedH1[!unlist(lapply(importedH1, is.null))])
```

It can import the CL, CE, VD or SL tables `.zip` archives, but will include all other tables as `NULL`:

```{r}
importedSL <- RDBEScore:::createRDBESDataObject(input = "HSL_2023_10_16.zip")
#print the not NULL table names
names(importedSL[!unlist(lapply(importedSL, is.null))])
```

It can also handle overwriting `zip` file original files with files appearing later in the list. However each overwrite results in a warning!

```{r}
importedTables <- RDBEScore:::createRDBESDataObject(input = c("HSL_2023_10_16.zip", "H1_2023_10_16.zip"))
#print the not NULL table names
names(importedTables[!unlist(lapply(importedTables, is.null))])
```

## Importing csv files

It can also import the unzipped `.csv` files with the default RDBES names:

```{r}
importedVS <- RDBEScore:::createRDBESDataObject(input = "./",
                                                listOfFileNames = list("VS" = "VesselSelection.csv"))
#print the not NULL table names
names(importedTables[!unlist(lapply(importedTables, is.null))])
```

## Importing list of data frames

It can also import a `list` object containing data frames (or data.tables). However, it should be noted that this type of import bypasses the RDBES upload data integrity checks.

```{r}
#list of data frames 
listOfDfsH1 <- readRDS("H1_2023_10_19.rds")
#print the class of the list elements 
sapply(listOfDfsH1, class)
```

```{r}
importedList <- RDBEScore:::createRDBESDataObject(listOfDfsH1)
```

## Object class

It should be noted that the objects created are of the S3 class "RDBESDataObject"

```{r}
importedTables <- RDBEScore:::createRDBESDataObject("H1_2023_10_16.zip")
class(importedTables)
```

RDBESDataObject structure can be validated using the validateRDBESDataObject() function.

```{r}
importedTables <- RDBEScore:::createRDBESDataObject("H1_2023_10_16.zip")
validateRDBESDataObject(importedTables, verbose = FALSE)
```

```{r}
#END
```
