<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Estimating Population parameters from RDBESDataObjects • RDBEScore</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Estimating Population parameters from RDBESDataObjects">
<meta property="og:description" content="RDBEScore">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">RDBEScore</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/estimating-rdbesdataobjects.html">Estimating Population parameters from RDBESDataObjects</a>
    </li>
    <li>
      <a href="../articles/generating-NAs-using-the-species-list.html">Generating NAs using the Species List</a>
    </li>
    <li>
      <a href="../articles/generating-probabilities.html">Generating probabilities</a>
    </li>
    <li>
      <a href="../articles/generating-zeros-using-the-species-list.html">Generating Zeros using the Species List</a>
    </li>
    <li>
      <a href="../articles/manipulating-rdbesdataobjects.html">Manipulating RDBESDataObjects</a>
    </li>
    <li>
      <a href="../articles/raw-data-import.html">Raw Data Import</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ices-tools-dev/RDBEScore/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Estimating Population parameters from
RDBESDataObjects</h1>
            
            <h4 data-toc-skip class="date">2023-11-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ices-tools-dev/RDBEScore/blob/HEAD/vignettes/estimating-rdbesdataobjects.Rmd" class="external-link"><code>vignettes/estimating-rdbesdataobjects.Rmd</code></a></small>
      <div class="hidden name"><code>estimating-rdbesdataobjects.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The aim of this document is to illustrate how population parameters
like total and mean can be estimated using the
<strong>estimMC(…)</strong> function. And how a multi level or multi
stratum estimation can be run to estimate the population total and mean
using <strong>doEstimationForAllStrata(…)</strong>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ices-tools-dev/RDBEScore" class="external-link">RDBEScore</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="prerequisites">Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites"></a>
</h2>
<p>First we’ll load some example data from the RDBES and check it’s
valid. It’s a good idea to check your RDBESDataObjects are valid after
any manipulations you perform.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">h1d</span> <span class="op">&lt;-</span> <span class="va">H1Example</span></span>
<span><span class="fu"><a href="../reference/validateRDBESDataObject.html">validateRDBESDataObject</a></span><span class="op">(</span><span class="va">h1d</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">h1d</span></span>
<span><span class="co">#&gt; Hierarchy 1 RDBESdataObject:</span></span>
<span><span class="co">#&gt;  DE: 8</span></span>
<span><span class="co">#&gt;  SD: 8</span></span>
<span><span class="co">#&gt;  VS: 1214 (SRSWOR,CENSUS,SRSWR: 2-135/4-1382)</span></span>
<span><span class="co">#&gt;  FT: 1430 (CENSUS,SRSWR: 1-3/1-100)</span></span>
<span><span class="co">#&gt;  FO: 1916 (CENSUS,SRSWR: 1-3/1-20)</span></span>
<span><span class="co">#&gt;  SS: 1916 (CENSUS,SRSWR: 1/1-4)</span></span>
<span><span class="co">#&gt;  SA: 1916 (CENSUS,SRSWR: 1/1-2)</span></span>
<span><span class="co">#&gt;  FM: 7290</span></span>
<span><span class="co">#&gt;  BV: 14580 (SRSWR: 2/2)</span></span>
<span><span class="co">#&gt;  VD: 311</span></span>
<span><span class="co">#&gt;  SL: 170</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="single-level-multiple-count-estimator">Single level Multiple Count Estimator<a class="anchor" aria-label="anchor" href="#single-level-multiple-count-estimator"></a>
</h2>
<p>Let’s first estimate the last level values for a single FMid so that
estimation is done for one top level record</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">FMidSel</span> <span class="op">&lt;-</span> <span class="st">"4033243"</span></span>
<span><span class="va">BV</span> <span class="op">&lt;-</span> <span class="va">h1d</span><span class="op">$</span><span class="va">BV</span><span class="op">[</span><span class="va">h1d</span><span class="op">$</span><span class="va">BV</span><span class="op">$</span><span class="va">FMid</span> <span class="op">==</span> <span class="va">FMidSel</span>,<span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="../reference/estimMC.html">estimMC</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">BV</span><span class="op">$</span><span class="va">BVvalueMeas</span><span class="op">)</span>,</span>
<span>        <span class="va">BV</span><span class="op">$</span><span class="va">BVnumSamp</span>,</span>
<span>        <span class="va">BV</span><span class="op">$</span><span class="va">BVnumTotal</span>, </span>
<span>        method<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">BV</span><span class="op">$</span><span class="va">BVselectMeth</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $est.total</span></span>
<span><span class="co">#&gt; [1] 4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $est.mean</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $est.algorithm</span></span>
<span><span class="co">#&gt; [1] "Generalized Horvitz-Thompson aka Mutiple-Count"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $var.total</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $var.mean</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $var.algorithm</span></span>
<span><span class="co">#&gt; [1] "Sen-Yates-Grundy"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $PI</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]  0.5  0.5</span></span>
<span><span class="co">#&gt; [2,]  0.5  0.5</span></span></code></pre></div>
<p>This <strong>estimMC(…)</strong> function is actually the core of the
estimation functions running on multiple levels as well. For
implementation details see: <a href="https://github.com/ices-tools-dev/RDBEScore/issues/13" class="external-link">Variance
calculation functions using “Multiple count” estimator</a></p>
</div>
<div class="section level2">
<h2 id="estimation-workflow">Estimation workflow<a class="anchor" aria-label="anchor" href="#estimation-workflow"></a>
</h2>
<p>Estimation actually is done on a <em>RDBESEstObject</em> that is
generate from <em>RDBESDataObject</em> using
<strong>createRDBESEstObject(…)</strong>. The following example uses a
dataset that resembles in many ways real data at ICES area 27.3.d.28.1
from the Estonian Baltic Trawling fleet for 2022 sprat (<em>Sprattus
sprattus</em>).The dataset has both total landings and commercial
sampling data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">H8ExampleEE1</span></span>
<span><span class="co">#&gt; Hierarchy 8 RDBESdataObject:</span></span>
<span><span class="co">#&gt;  DE: 1</span></span>
<span><span class="co">#&gt;  SD: 1</span></span>
<span><span class="co">#&gt;  TE: 11 (SRSWOR: 2-3/4)</span></span>
<span><span class="co">#&gt;  VS: 14 (SRSWR: 1-2/7-12)</span></span>
<span><span class="co">#&gt;  LE: 15 (SRSWOR: 1-2/1-2)</span></span>
<span><span class="co">#&gt;  SS: 15 (CENSUS: 2/2)</span></span>
<span><span class="co">#&gt;  SA: 15 (SRSWOR: 1/794-14268)</span></span>
<span><span class="co">#&gt;  BV: 3995 (CENSUS: 16-100/16-100)</span></span>
<span><span class="co">#&gt;  VD: 7</span></span>
<span><span class="co">#&gt;  SL: 2</span></span>
<span><span class="co">#&gt;  CL: 71</span></span>
<span><span class="co">#&gt;  CE: 132</span></span></code></pre></div>
<p>The data has not gone through RDBES upload and download procedure and
contains invalid data types but also may have some other validity
problems. However the fields for estimation should be present and
valid.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#to check data types</span></span>
<span><span class="fu"><a href="../reference/validateRDBESDataObject.html">validateRDBESDataObject</a></span><span class="op">(</span><span class="va">H8ExampleEE1</span>, checkDataTypes <span class="op">=</span> <span class="cn">TRUE</span>, strict <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#create the estimation object to estimate values on the SA table</span></span>
<span><span class="va">estData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createRDBESEstObject.html">createRDBESEstObject</a></span><span class="op">(</span><span class="va">H8ExampleEE1</span>, <span class="fl">8</span>, <span class="st">"SA"</span> <span class="op">)</span></span>
<span></span>
<span><span class="co">#the SAsampWtMes is in grammes let's estimate in tonnes</span></span>
<span><span class="va">estData</span><span class="op">$</span><span class="va">SAsampWtMes</span> <span class="op">&lt;-</span> <span class="va">estData</span><span class="op">$</span><span class="va">SAsampWtMes</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1000</span> <span class="op">*</span> <span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/doEstimationForAllStrata.html">doEstimationForAllStrata</a></span><span class="op">(</span><span class="va">estData</span>, <span class="st">"SAsampWtMes"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#let's compare the results from 1st quarter with actual catches from Q1</span></span>
<span><span class="va">CL</span> <span class="op">&lt;-</span> <span class="va">H8ExampleEE1</span><span class="op">$</span><span class="va">CL</span></span>
<span><span class="va">Q1months</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"January"</span>, <span class="st">"February"</span>, <span class="st">"March"</span><span class="op">)</span></span>
<span><span class="va">Q1results</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">[</span><span class="va">results</span><span class="op">$</span><span class="va">recType</span><span class="op">==</span> <span class="st">"TE"</span> <span class="op">&amp;</span></span>
<span>                     <span class="va">results</span><span class="op">$</span><span class="va">stratumName</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">Q1months</span>,<span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Total estimated SPR catch in Q1: "</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Q1results</span><span class="op">$</span><span class="va">est.total</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>,  <span class="st">"tonnes\n"</span><span class="op">)</span></span></code></pre></div>
<p>Total estimated SPR catch in Q1: 381.262 tonnes</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#CLoffWeight is in Kg, converting to tonnes</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Total reported  SPR catch in Q1: "</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">CL</span><span class="op">[</span><span class="va">CL</span><span class="op">$</span><span class="va">CLquar</span> <span class="op">==</span><span class="fl">1</span>, <span class="st">"CLoffWeight"</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="fl">1000</span>, <span class="st">"tonnes"</span><span class="op">)</span></span></code></pre></div>
<p>Total reported SPR catch in Q1: 396.21 tonnes</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#let's add the actual totals</span></span>
<span><span class="va">Q1results</span><span class="op">$</span><span class="va">actualTotals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>February<span class="op">=</span><span class="fl">124.829</span>,January<span class="op">=</span><span class="fl">119.108</span>, March<span class="op">=</span><span class="fl">152.273</span><span class="op">)</span></span></code></pre></div>
<p>So the total estimated catch (<em>est.total</em>) for the first
quarter is near the total of the actual catch. The table below gives the
estimates by month with standard errors (<em>se.total</em>). The
(<em>est.mean</em>) and its standard error (SE, <em>se.mean</em>) are
the estimated mean catch of sprat per week in the given month.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#there are 4 weeks and 2 are sampled in TE so in this case the total is: </span></span>
<span><span class="co">#mean * 4 </span></span>
<span><span class="va">Q1results</span><span class="op">$</span><span class="va">est.mean</span> <span class="op">*</span> <span class="fl">4</span></span>
<span><span class="co">#&gt; [1] 209.27146 138.99464  32.99554</span></span></code></pre></div>
<p>As you can see from the table for the first 2 months the estimates
with <em>se.total</em> are in line with the estimate as for March
somehow there is a big discrepancy.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">columns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"recType"</span>,<span class="st">"stratumName"</span>,<span class="st">"actualTotals"</span>,</span>
<span>             <span class="st">"est.total"</span>, <span class="st">"se.total"</span>, <span class="st">"est.mean"</span>, <span class="st">"se.mean"</span><span class="op">)</span></span>
<span><span class="va">captionText</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Estmation results for 1st quarter by months (stratums)."</span>,</span>
<span>                     <span class="st">"Total estimated catch (est.total) and standard error (se.total)"</span>,</span>
<span>                     <span class="st">" as well as estimated mean with se for vessels are given."</span>,</span>
<span>                     <span class="st">"In addition actual total reported weights are given."</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">Q1results</span><span class="op">[</span><span class="va">columns</span><span class="op">]</span>, digits<span class="op">=</span><span class="fl">3</span>, caption<span class="op">=</span><span class="va">captionText</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Estmation results for 1st quarter by months (stratums). Total
estimated catch (est.total) and standard error (se.total) as well as
estimated mean with se for vessels are given. In addition actual total
reported weights are given.</caption>
<colgroup>
<col width="4%">
<col width="11%">
<col width="16%">
<col width="18%">
<col width="13%">
<col width="12%">
<col width="12%">
<col width="11%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="left">recType</th>
<th align="left">stratumName</th>
<th align="right">actualTotals</th>
<th align="right">est.total</th>
<th align="right">se.total</th>
<th align="right">est.mean</th>
<th align="right">se.mean</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">56</td>
<td align="left">TE</td>
<td align="left">February</td>
<td align="right">124.829</td>
<td align="right">209.271</td>
<td align="right">97.071</td>
<td align="right">52.318</td>
<td align="right">24.268</td>
</tr>
<tr class="even">
<td align="left">57</td>
<td align="left">TE</td>
<td align="left">January</td>
<td align="right">119.108</td>
<td align="right">138.995</td>
<td align="right">41.709</td>
<td align="right">34.749</td>
<td align="right">10.427</td>
</tr>
<tr class="odd">
<td align="left">58</td>
<td align="left">TE</td>
<td align="left">March</td>
<td align="right">152.273</td>
<td align="right">32.996</td>
<td align="right">7.213</td>
<td align="right">8.249</td>
<td align="right">1.803</td>
</tr>
</tbody>
</table>
<p>In the next sections we will use data from R packages <a href="https://CRAN.R-project.org/package=survey" class="external-link">survey</a> and <a href="https://CRAN.R-project.org/package=SDAResources" class="external-link">SDAResources</a>
that are converted into the <em>RDBESDataObject</em> to demonstrate the
estimation procedure.</p>
<div class="section level3">
<h3 id="estimation-on-multiple-strata">Estimation on Multiple Strata<a class="anchor" aria-label="anchor" href="#estimation-on-multiple-strata"></a>
</h3>
<p>From <a href="https://CRAN.R-project.org/package=SDAResources" class="external-link">SDAResources</a>
we use <em>agstrat</em> which is data from a stratified random sample of
size 300 from the 1992 U.S. Census of Agriculture agpop data. The datset
is converted into <em>RDBESDataObject</em>
<strong>Pckg_SDAResources_agstrat_H1</strong> so that Table VS and SA
contain the core information of used in Lohr examples 3.2 and 3.6. Table
VS is stratified with VSstratumName set to <em>region</em>, and
VSnumberSampled and VSnumberTotal set according to <em>agstrat</em>
VSunitName is set to a combination of original <em>county</em>,
<em>state</em>, <em>region</em> and <em>agstrat</em> row numbers. Table
SA contains the variable measured <em>acres92</em> in , and set to 1.
Table DE, SD, FT and FO are for the most dummy tables inserted to meet
RDBES model requirements to be aggregated during estimation tests.
Values of mandatory fields have dummy values taken from an onboard
programme, with exception of * - that is set to CENSUS - they should be
ignored during estimation. BV, FM, CL, and CE are not provided. SL and
VD are subset to the essential rows.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">agstrat_H1</span> <span class="op">&lt;-</span> <span class="va">Pckg_SDAResources_agstrat_H1</span> <span class="co">#valid</span></span>
<span><span class="va">agstrat_H1</span></span>
<span><span class="co">#&gt; Hierarchy 1 RDBESdataObject:</span></span>
<span><span class="co">#&gt;  DE: 1</span></span>
<span><span class="co">#&gt;  SD: 1</span></span>
<span><span class="co">#&gt;  VS: 300 (SRSWOR: 21-135/220-1382)</span></span>
<span><span class="co">#&gt;  FT: 300 (CENSUS: 1/1)</span></span>
<span><span class="co">#&gt;  FO: 300 (CENSUS: 1/1)</span></span>
<span><span class="co">#&gt;  SS: 300 (CENSUS: 1/1)</span></span>
<span><span class="co">#&gt;  SA: 300 (CENSUS: 1/1)</span></span>
<span><span class="co">#&gt;  FM: 0</span></span>
<span><span class="co">#&gt;  BV: 0</span></span>
<span><span class="co">#&gt;  VD: 311</span></span>
<span><span class="co">#&gt;  SL: 1</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#create the estimation object to estimate values on the SA table</span></span>
<span><span class="va">estObj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createRDBESEstObject.html">createRDBESEstObject</a></span><span class="op">(</span><span class="va">agstrat_H1</span>, <span class="fl">1</span>, <span class="st">"SA"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/doEstimationForAllStrata.html">doEstimationForAllStrata</a></span><span class="op">(</span><span class="va">estObj</span>, <span class="st">"SAsampWtMes"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get the estimated total and mean  for "SAsampWtMes" for the VS stratum "NC"</span></span>
<span><span class="va">columns2Get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"est.total"</span>,<span class="st">"est.mean"</span>, <span class="st">"se.total"</span>,<span class="st">"se.mean"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">res</span><span class="op">[</span><span class="va">res</span><span class="op">$</span><span class="va">recType</span> <span class="op">==</span> <span class="st">"VS"</span> <span class="op">&amp;</span> <span class="va">res</span><span class="op">$</span><span class="va">stratumName</span> <span class="op">==</span> <span class="st">"NC"</span> ,<span class="va">columns2Get</span><span class="op">]</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt;   est.total    est.mean    se.total     se.mean </span></span>
<span><span class="co">#&gt; 316731379.7    300504.2  16977399.2     16107.6</span></span></code></pre></div>
<p>How to interpret these results in the above example?</p>
<ul>
<li>
<em>est.total</em> - total SAsampWtMes sampled weight per vessel per
year in the stratum</li>
<li>
<em>est.mean</em> - mean SAsampWtMes per vessel per year in the
stratum (i.e how much in total one ship on average contributed to the
sampled total in this stratum)</li>
</ul>
<p>You can explore the result to see the estimated total, mean etc. for
other stratums.</p>
</div>
<div class="section level3">
<h3 id="two-level-estimation-on-single-stratum">Two Level Estimation on Single Stratum<a class="anchor" aria-label="anchor" href="#two-level-estimation-on-single-stratum"></a>
</h3>
<p>From <a href="https://CRAN.R-project.org/package=survey" class="external-link">survey</a>
we use apiclus2 which is the Academic Performance Index computed for all
California schools based on standardised testing of students. The data
sets contain information for all schools with at least 100 students and
for various probability samples of the data. The design is 2-stage
cluster sampling with clusters of unequal sizes An SRS of 40 districts
is selected (psus) from the 757 districts in the population and then up
to 5 schools (min 1) were selected from each district (ssus) The datset
is converted into <em>RDBESDataObject</em>
<strong>Pckg_survey_apiclus2_H1</strong> so that 1 DE row with
DEstratumName == “Pckg_SDAResources_apiclus2_H1”, 1 child SD row, 40
child rows in VS (the 40 districts), VSnumberTotal is 757,
VSnumberSampled is 40, 126 child rows in FT (the 126 schools finally
observed), each associated to its cluster (dname), FTnumberTotal is the
number of schools in district, FTnumberSAmpled is 1…5 schools sampled,
tables FO, SS are just 1:1 links to the final data (in SA), in SA
SAsampleWeightMeasured is enroll (NB! there are 4 NAs)</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">apiclus2_H1</span> <span class="op">&lt;-</span> <span class="va">Pckg_survey_apiclus2_H1</span> <span class="co"># valid H1</span></span>
<span><span class="va">apiclus2_H1</span></span>
<span><span class="co">#&gt; Hierarchy 1 RDBESdataObject:</span></span>
<span><span class="co">#&gt;  DE: 1</span></span>
<span><span class="co">#&gt;  SD: 1</span></span>
<span><span class="co">#&gt;  VS: 40 (SRSWOR: 40/757)</span></span>
<span><span class="co">#&gt;  FT: 126 (SRSWOR: 1-5/1-72)</span></span>
<span><span class="co">#&gt;  FO: 126 (CENSUS: 10/10)</span></span>
<span><span class="co">#&gt;  SS: 126 (CENSUS: 1/1)</span></span>
<span><span class="co">#&gt;  SA: 126 (CENSUS: 1/1)</span></span>
<span><span class="co">#&gt;  FM: 0</span></span>
<span><span class="co">#&gt;  BV: 0</span></span>
<span><span class="co">#&gt;  VD: 311</span></span>
<span><span class="co">#&gt;  SL: 1</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#create the estimation object to estimate values on the SA table</span></span>
<span><span class="va">estObj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createRDBESEstObject.html">createRDBESEstObject</a></span><span class="op">(</span><span class="va">apiclus2_H1</span>, <span class="fl">1</span>, <span class="st">"SA"</span><span class="op">)</span></span>
<span>    </span>
<span><span class="co"># Run estimation on total measured weight: SAtotalWtMes</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/doEstimationForAllStrata.html">doEstimationForAllStrata</a></span><span class="op">(</span><span class="va">estObj</span>, <span class="st">"SAtotalWtMes"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get the estimated total and mean  for "SAtotalWtMes" for the VS</span></span>
<span><span class="va">columns2Get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"est.total"</span>,<span class="st">"est.mean"</span>, <span class="st">"se.total"</span>,<span class="st">"se.mean"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">res</span><span class="op">[</span><span class="va">res</span><span class="op">$</span><span class="va">recType</span> <span class="op">==</span> <span class="st">"VS"</span> ,<span class="va">columns2Get</span><span class="op">]</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; est.total  est.mean  se.total   se.mean </span></span>
<span><span class="co">#&gt; 2639272.9    3486.5  798295.7    1054.6</span></span></code></pre></div>
<p>How to interpret these results in the above example?</p>
<ul>
<li>
<em>est.total</em> - total caught weight per vessel per year</li>
<li>
<em>est.mean</em> - mean caught weight per vessel per year (i.e how
much in total one ship on average contributed to the total catch per
year)</li>
</ul>
<p>The <strong>SE</strong> values are just the standard errors for the
total and mean respectively.</p>
<p>See also other package vignettes:</p>
<ul>
<li><a href="raw-data-import.html">Raw Data Import</a></li>
<li><a href="manipulating-rdbesdataobjects.html">Manipulating
RDBESDataObjects</a></li>
<li><a href="generating-probabilities.html">Generating
probabilities</a></li>
<li><a href="generating-NAs-using-the-species-list.html">Generating NAs
using the Species List</a></li>
<li><a href="generating-zeros-using-the-species-list.html">Generating
Zeros using the Species List</a></li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Colin Millar.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
