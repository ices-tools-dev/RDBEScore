<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Generating Zeros using the Species List • RDBEScore</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Generating Zeros using the Species List">
<meta property="og:description" content="RDBEScore">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">RDBEScore</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/estimating-rdbesdataobjects.html">Estimating Population parameters from RDBESDataObjects</a>
    </li>
    <li>
      <a href="../articles/generating-NAs-using-the-species-list.html">Generating NAs using the Species List</a>
    </li>
    <li>
      <a href="../articles/generating-probabilities.html">Generating probabilities</a>
    </li>
    <li>
      <a href="../articles/generating-zeros-using-the-species-list.html">Generating Zeros using the Species List</a>
    </li>
    <li>
      <a href="../articles/manipulating-rdbesdataobjects.html">Manipulating RDBESDataObjects</a>
    </li>
    <li>
      <a href="../articles/raw-data-import.html">Raw Data Import</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ices-tools-dev/RDBEScore/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Generating Zeros using the Species List</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ices-tools-dev/RDBEScore/blob/HEAD/vignettes/generating-zeros-using-the-species-list.Rmd" class="external-link"><code>vignettes/generating-zeros-using-the-species-list.Rmd</code></a></small>
      <div class="hidden name"><code>generating-zeros-using-the-species-list.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The aim of this document is demonstrate how the Species List table
(SL) of the RDBES can be used to complement the sample table with zeros
in cases where, e.g., a species was looked for but not found and
therefore does not appear in the Sample table (SA) of the RDBES. The
task of adding zeros to the Sample table (SA) is made easy by using the
function <code>generateZerosUsingSL</code> available in the
<code>RDBEScore</code> package.</p>
</div>
<div class="section level2">
<h2 id="load-the-package">Load the package<a class="anchor" aria-label="anchor" href="#load-the-package"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ices-tools-dev/RDBEScore" class="external-link">RDBEScore</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="load-and-validate-example-data">Load and validate example data<a class="anchor" aria-label="anchor" href="#load-and-validate-example-data"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read an example dataset and simplify it to 1 trip and 1 haul [dev bote: this section needs to be reworked when data and filterRDBESDataObject are  updated]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Pckg_survey_apistrat_H1</span><span class="op">)</span></span>
<span><span class="va">myH1DataObject1</span> <span class="op">&lt;-</span> <span class="va">Pckg_survey_apistrat_H1</span></span>
<span><span class="va">myH1DataObject1</span><span class="op">$</span><span class="va">SL</span><span class="op">&lt;-</span><span class="va">myH1DataObject1</span><span class="op">$</span><span class="va">SL</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="va">myH1DataObject1</span><span class="op">$</span><span class="va">SL</span><span class="op">$</span><span class="va">SLspeclistName</span>, pat<span class="op">=</span><span class="st">"Pckg_survey_apistrat_H1"</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="co">#myH1DataObject1&lt;-filterAndTidyRDBESDataObject(myH1DataObject1, fieldsToFilter="FOid",valuesToFilter=70849, killOrphans = TRUE)</span></span>
<span><span class="va">myH1DataObject1</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/filterRDBESDataObject.html">filterRDBESDataObject</a></span><span class="op">(</span><span class="va">myH1DataObject1</span>, fieldsToFilter<span class="op">=</span><span class="st">"SSid"</span>,valuesToFilter<span class="op">=</span><span class="fl">227694</span>, killOrphans <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># check it is a valid RDBESobject</span></span>
<span><span class="fu"><a href="../reference/validateRDBESDataObject.html">validateRDBESDataObject</a></span><span class="op">(</span><span class="va">myH1DataObject1</span>, checkDataTypes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="a-closer-look-the-example-data-and-its-characteristics">A closer look the example data and its characteristics<a class="anchor" aria-label="anchor" href="#a-closer-look-the-example-data-and-its-characteristics"></a>
</h2>
<p>The example is from data in hierarchy 1. It contains a single trip
with a single haul. For simplicity, we restrict our analysis to the
tables SL, SS and SA which are the ones handled by the functions we
which behaviour we want to demonstrate.</p>
<p>Examining a print of the Species List (SL) one can conclude that the
sampling targeted the landings of only 1 species. In this case the
species was <em>Nephrops norvegicus</em> (aphiaId 107254).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myH1DataObject1</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SL"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt; $SL</span></span>
<span><span class="co">#&gt;     SLid SLrecType SLcou SLinst                             SLspeclistName</span></span>
<span><span class="co">#&gt; 1: 47891        SL    ZW   4484 WGRDBES-EST_TEST_1_Pckg_survey_apistrat_H1</span></span>
<span><span class="co">#&gt;    SLyear SLcatchFrac SLcommTaxon SLsppCode</span></span>
<span><span class="co">#&gt; 1:   1965         Lan      107254    107254</span></span></code></pre></div>
<p>Examining a print of the Species Selection table (SS), one can
confirm that only one fishing operation is present in the data (FOid
70849) and that landings were indeed sampled from it (for simplicity
only a subset of columns is printed). Note that variable is set to “N”
(i.e., No). This will have to be changed later on if we want zeros
calculated.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myH1DataObject1</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SS"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">15</span>,<span class="fl">19</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;      SSid LEid  FOid TEid FTid  SLid OSid SSrecType SSseqNum SSstratification</span></span>
<span><span class="co">#&gt; 1: 227694   NA 70849   NA   NA 47891   NA        SS        1                N</span></span>
<span><span class="co">#&gt;    SSstratumName SSclustering SSclusterName SSobsActTyp SScatchFra</span></span>
<span><span class="co">#&gt; 1:             U            N             U        Sort        Lan</span></span>
<span><span class="co">#&gt;    SSuseCalcZero</span></span>
<span><span class="co">#&gt; 1:             N</span></span></code></pre></div>
<p>Given the previous, it is expected that if <em>Nephrops
norvegicus</em> was sampled it will appear in the RDBES Sample table
(SA). One can confirm that happened by printing that table (for
simplicity only a subset of columns is printed).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myH1DataObject1</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SA"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span>,<span class="fl">48</span><span class="op">:</span><span class="fl">49</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;      SAid   SSid LEid SArecType SAseqNum SAparSequNum SAstratification</span></span>
<span><span class="co">#&gt; 1: 572813 227694   NA        SA        1           NA                N</span></span>
<span><span class="co">#&gt;    SAstratumName SAspeCode SAtotalWtMes SAsampWtMes</span></span>
<span><span class="co">#&gt; 1:             U    107254          276         276</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="generating-zeros-for-species-looked-for-but-not-reported-in-the-sa-table">Generating Zeros for species looked for but not reported in the SA
table<a class="anchor" aria-label="anchor" href="#generating-zeros-for-species-looked-for-but-not-reported-in-the-sa-table"></a>
</h2>
<p>Lets change the example, by adding a couple of new species
(<em>Pandalus borealis</em> and <em>Cancer pagurus</em>) to the Species
List table (SS). We also change variable to “Y” so that zeros can be
calculated.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># first we duplicate the SL</span></span>
<span><span class="va">myH1DataObject1</span><span class="op">$</span><span class="va">SL</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">myH1DataObject1</span><span class="op">$</span><span class="va">SL</span>, <span class="va">myH1DataObject1</span><span class="op">$</span><span class="va">SL</span>, <span class="va">myH1DataObject1</span><span class="op">$</span><span class="va">SL</span><span class="op">)</span></span>
<span><span class="co"># then we update a few fields and reset the SL key</span></span>
<span><span class="va">myH1DataObject1</span><span class="op">$</span><span class="va">SL</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SLid"</span>,<span class="st">"SLcommTaxon"</span>,<span class="st">"SLsppCode"</span><span class="op">)</span><span class="op">]</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">47892</span>, <span class="fl">47893</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">107276</span>, <span class="fl">107649</span><span class="op">)</span>,   <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">107276</span>, <span class="fl">107649</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setkey.html" class="external-link">setkeyv</a></span><span class="op">(</span><span class="va">myH1DataObject1</span><span class="op">$</span><span class="va">SL</span>,<span class="st">"SLid"</span><span class="op">)</span></span>
<span><span class="co"># change SSuseCalcZero to "Y"</span></span>
<span><span class="va">myH1DataObject1</span><span class="op">$</span><span class="va">SS</span><span class="op">$</span><span class="va">SSuseCalcZero</span><span class="op">&lt;-</span><span class="st">"Y"</span></span>
<span><span class="co"># finally we make sure the object we created is a valid RDBES data object. No message is a good sign.</span></span>
<span><span class="fu"><a href="../reference/validateRDBESDataObject.html">validateRDBESDataObject</a></span><span class="op">(</span><span class="va">myH1DataObject1</span>, checkDataTypes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># display new SL</span></span>
<span><span class="va">myH1DataObject1</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SL"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt; $SL</span></span>
<span><span class="co">#&gt;     SLid SLrecType SLcou SLinst                             SLspeclistName</span></span>
<span><span class="co">#&gt; 1: 47891        SL    ZW   4484 WGRDBES-EST_TEST_1_Pckg_survey_apistrat_H1</span></span>
<span><span class="co">#&gt; 2: 47892        SL    ZW   4484 WGRDBES-EST_TEST_1_Pckg_survey_apistrat_H1</span></span>
<span><span class="co">#&gt; 3: 47893        SL    ZW   4484 WGRDBES-EST_TEST_1_Pckg_survey_apistrat_H1</span></span>
<span><span class="co">#&gt;    SLyear SLcatchFrac SLcommTaxon SLsppCode</span></span>
<span><span class="co">#&gt; 1:   1965         Lan      107254    107254</span></span>
<span><span class="co">#&gt; 2:   1965         Lan      107276    107276</span></span>
<span><span class="co">#&gt; 3:   1965         Lan      107649    107649</span></span></code></pre></div>
<p>After the update, the new dataset likens a situation where observers
looked for three species (<em>Nephrops norvegicus</em>, <em>Cancer
pagurus</em> and <em>Pandalus borealis</em>) with only one of them
(<em>Nephrops norvegicus</em>) having been found in the sample. Running
function the zeros for those additional species can be quickly
added.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myH1DataObject1updte</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/generateZerosUsingSL.html">generateZerosUsingSL</a></span><span class="op">(</span><span class="va">myH1DataObject1</span><span class="op">)</span></span>
<span><span class="va">myH1DataObject1updte</span><span class="op">$</span><span class="va">SA</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span>,<span class="fl">48</span><span class="op">:</span><span class="fl">49</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;      SAid   SSid LEid SArecType SAseqNum SAparSequNum SAstratification</span></span>
<span><span class="co">#&gt; 1: 572813 227694   NA        SA    0.998           NA                N</span></span>
<span><span class="co">#&gt; 2: 572813 227694   NA        SA    0.999           NA                N</span></span>
<span><span class="co">#&gt; 3: 572813 227694   NA        SA    1.000           NA                N</span></span>
<span><span class="co">#&gt;    SAstratumName SAspeCode SAtotalWtMes SAsampWtMes</span></span>
<span><span class="co">#&gt; 1:             U    107649            0           0</span></span>
<span><span class="co">#&gt; 2:             U    107276            0           0</span></span>
<span><span class="co">#&gt; 3:             U    107254          276         276</span></span></code></pre></div>
<p>Note that the new rows have floating points values for SAid and
SAseqNum (we use sprintf to ensure the decimal places are displayed).
This facilitates the ordering of the samples and prevents overlaps when
different datasets are joined. Also a SAunitName was created for the new
rows that is identical to the SAid.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="va">myH1DataObject1updte</span><span class="op">[[</span><span class="st">'SA'</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">SAid</span>, fmt <span class="op">=</span> <span class="st">'%.3f'</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "572812.998" "572812.999" "572813.000"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="va">myH1DataObject1updte</span><span class="op">[[</span><span class="st">'SA'</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">SAseqNum</span>, fmt <span class="op">=</span> <span class="st">'%.3f'</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "0.998" "0.999" "1.000"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">myH1DataObject1updte</span><span class="op">[[</span><span class="st">'SA'</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">SAunitName</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "572812.998" "572812.999" "1"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="section">…<a class="anchor" aria-label="anchor" href="#section"></a>
</h2>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Colin Millar.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
