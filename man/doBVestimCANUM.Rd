% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/doBVestimCACNUM.R
\name{doBVestimCANUM}
\alias{doBVestimCANUM}
\title{Estimate Catch at Number (CANUM) for Biological Variables}
\usage{
doBVestimCANUM(
  bv,
  addColumns,
  classUnits = "Ageyear",
  classBreaks = 1:8,
  verbose = FALSE
)
}
\arguments{
\item{bv}{A \code{data.table} containing biological data, with columns for the biological variable, class units (e.g., \code{Ageyear}, \code{Lengthmm}, \code{Weightg}), and other relevant variables.}

\item{addColumns}{A character vector of additional column names used to group the data for aggregation (e.g., \code{BVfishId} and other identifiers).}

\item{classUnits}{A character string specifying the class units of the biological variable to use for grouping (e.g., "Ageyear", "Lengthmm", "Weightg"). Default is "Ageyear".}

\item{classBreaks}{A numeric vector specifying the breakpoints for classifying the biological variable. The last value defines the lower bound of the "plus group". Default is \code{1:8} for age groups.}

\item{verbose}{Logical, if \code{TRUE}, prints detailed information about the process. Default is \code{FALSE}.}
}
\value{
A \code{data.table} containing the aggregated results, including groupings, calculated means, proportions, indices, and totals for the specified biological variable.
}
\description{
This function estimates catch at number (CANUM) for a specified biological variable, such as age or length. It aggregates data based on specified columns and generates a "plus group" for the highest value in the defined classes. The function supports grouping by various units (e.g., age, length, weight) and calculates required indices, totals, and proportions for the groups.
}
\details{
The function performs the following steps:
\itemize{
\item Validates the presence of the \code{classUnits} in the biological variable data.
\item Reshapes the input data using \code{dcast} and groups the biological variable into classes using \code{cut()}.
\item Aggregates mean weights and lengths by the defined classes, along with calculating proportions and indices based on the sample size.
\item A "plus group" is created for values exceeding the highest \code{classBreaks} value.
\item Calculates total weights, catch numbers, and performs a sanity check to ensure there are no rounding errors in the final results.
}
\subsection{Mathematical Logic:}{

Let:
\itemize{
\item \( W_{mean} \) be the mean weight for each group.
\item \( L_{mean} \) be the mean length for each group.
\item \( n_W \) be the number of weight measurements in each group.
\item \( N \) be the total number of measurements in the sample.
\item \( P \) be the proportion of the sample represented by each group.
\item \( I_W \) be the weight index for each group.
\item \( S \) be the sum of weight indices across all groups.
\item \( C \) be the total catch weight.
\item \( T_W \) be the total weight for each group.
\item \( C_{num} \) be the total catch number for each group.
}

The calculations are as follows:
\enumerate{
\item Proportion of sample:
[
P = \frac{n_W}{N}
]

\item Weight Index:
[
I_W = P \times \left( \frac{W_{mean}}{1000} \right)
]

\item Sum of Weight Indices:
[
S = \sum I_W
]

\item Total Weight Coefficient:
[
\text{TWCoef} = \frac{C}{S}
]

\item Total Weight per Group:
[
T_W = I_W \times \text{TWCoef}
]

\item Total Catch Number per Group:
[
C_{num} = \frac{T_W}{\left( \frac{W_{mean}}{1000} \right)}
]
}
}
}
