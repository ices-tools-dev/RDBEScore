---
title: "Rename SASpeciesCode in SA"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Rename SASpeciesCode in SA}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Introduction
The aim of this document is to show how to rename the species code from sample 
based on species list using the function `renameSA` in the `RDBEScore` package.

## Load the package

```{r setup}
library(RDBEScore)
```

## Prerequisit
In the first step you need to load some example data with the RDBES format.
Good practice is to check that the RDBESDataObjects are valid. 

```{r}
# load an example dataset
myObject <- readRDS("D:/WK_RDBES/WGRDBES-EST/RDBEScore/WGRDBES-EST/personal/Kasia/vignettes/vignetteData/myObject.rds")
# check it is a valid RDBESobject
validateRDBESDataObject(myObject, checkDataTypes = TRUE)
```

## A closer look the example data and its characteristics

The example is from data in hierarchy 1. It contains a single trip with a single 
haul. For simplicity, we restrict our analysis to the tables SL, SS and SA which 
are the ones handled by the functions we which behaviour we want to demonstrate. 

Examining a print of the Species List table (SL) and part where SLspeclistName is 
*WGRDBES-EST_TEST_1_H1* can conclude that the sampling targeted the landings is 
only *Clupeidae* (aphiaId 125464).

```{r}
myObject$SL[SLspeclistName=='WGRDBES-EST_TEST_1_H1',]
```
In the Species Selecion table (SS) are eight fishing operation(FOid) 
```{r}
myObject[c("SS")]
```
The Species Selection Table which base on *WGRDBES-EST_TEST_1_H1* species list is

```{r}
myObject$SS[SLid==47867,]
```
The part which corresponds to SA table from SS table is

```{r}
myObject$SA[SSid==216649,]
```
Based on the SL table we are look for `Clupeidae`.

In the sample we received the `Sprattus sprattus` and `Clupea harengus`. Both of 
this species are from `Clupeidae` family. In this point will be usefull `renameSA` function.

## Rename species code in SA table using SL table.
We looked for the fish from `Clupeidae` family but we had a more precise reading 
than we expected because we read fish in the species level which is more accurate 
rank, than family.


```{r}
myObjectnew<-renameSpeciesSA(RDBESDataObject=myObject,
                            validate=TRUE,
                            verbose=FALSE,
                            strict=TRUE)
```
Function is checking the rank of aphia id in both of tables SA and SL. If aphia 
id in SA table is more accurate than in SL table and aphia ids are from the 
same family then aphia id in SA table is renaming to aphia id from SL table. If aphia Ids are from diffrent families then the function is leaving the primary value. If we will have the opposite option when in SL table will be an accurate rank than SA table function is leaving the primary version too.

The newest Sample Table
```{r}
myObjectnew$SA[SSid==216649,]
```
